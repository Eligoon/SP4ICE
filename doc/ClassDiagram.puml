@startuml

'Game controller'
class GameController {
    - currentLocation : Location
    'Attributes
    - ui : TextUI
    - emeraldTear : Story
    - db : DataSaving
    - url : String
    - player : Player
    'Game Flow
    + initializeGame() : void
    - displayClassSpecificIntro() : void
    'Movement
    + move(direction:String) : void
    + getCurrentLocation() : Location
    + getLocationChoices() : List<Choice>
    'Interaction
    + handleCombat(enemy:Creature) :void
    + handleNPCInteraction(npc:Creature) : void
    + handleUseItem(item:Item) : void
    + handleEquipArmour(item:Item) : void
    + handleEquipWeapon(item:Item) : void
}


'Text UI '
class TextUI {
    - sc : Scanner {static}
    'Prompts'
    + promptChoice(options : ArrayList<String>, limit : int, msg : String) : ArrayList<String>
    + promptNumeric(msg : String) : int
    + promptText(msg : String) : String
    + promptBinary(msg : String) : boolean
    + getPlayerInput() : String
    + promptChoiceOb(choices : List<Choice>, msg : String) : Choice
    'Display'
    + displayMsg(msg : String) : void
    + displayList(list : ArrayList<String>, msg : String) : void
    + displayChoices(choices : List<Choice>) : void
    + displayInventory(inventory : Inventory) : void
    + displayCombatStatus(player : Player, enemy : Creature) : void
    'Helper'
    +getAvailableChoices(all : List<Choice>, player : Player) : List<Choice>
}


'Saving data'
class DataSaving {
    - connection : Connection
    + connect(url : String) : void
    - createTables() : void
    'Save
    + saveGameState(gameController : GameController) : void
    + saveCurrentLocation(location : Location) : void
    + savePlayer(player : Player, location : Location) : void
    + saveInventory(player : Player) : void
    + saveNPCs(location : Location) : void
    'Load
    + loadGameState() : String
    + loadLocation(locationName : String, allLocations : Map<String, Location>) : Location
    + loadPlayer() : Player
    + loadInventory(player : Player) : void
    + loadNPCs(allLocations : Map<String, Location>, savedLocation : String) : void
    'Helpers
    + getRaceFromString(raceName : String) : Race
    + getClassFromString(className : String) : CharacterClass
    'Reset
    + deleteSave() : void
}


'Story'
class Story {
  ' Attributes
  - ui : TextUI
  - locations : Map<String, Location>
  - npcs : Map<String, NPC>
  ' Individual locations
  - theClearing : Location
  - huntingCabin : Location
  - theLake : Location
  - theForestPath : Location
  - theTravellingMerchant : Location
  - theSwampPath : Location
  - theMurkyWaters : Location
  - theWitchHut : Location
  - theOfferingBog : Location
  - theFrozenBog : Location
  - theMountainPath : Location
  - theRootsOfTheMountain : Location
  - theFreezingPass : Location
  - theCave : Location
  - theCrownOfTheWorld : Location
  'Constructor
  + Story()
  'Story setup
  + displayWelcomeMessage() : void
  + loadStory() : void
  + createLocations() : void
  + storeLocations() : void
  - connectLocations() : void
  - createNPCs() : void
  - populateCreatures() : void
  'Location access
  + getLocation(locationName : String) : Location
  'Dialogue systems
  + getMerchantDialogue(player : Player) : List<String>
  + handleMerchantDialogue(choice : int, player : Player) : String
  + getSirenDialogue(player : Player) : List<String>
  + handleSirenDialogue(choice : int, player : Player) : String
  + getWitchDialogue(player : Player) : List<String>
  + handleWitchDialogue(choice : int, player : Player) : String
  + getDragonDialogue(player : Player) : List<String>
  + handleDragonDialogue(choice : int, player : Player) : String
  + getDragonFollowUp(player : Player) : List<String>
  + handleDragonFollowUp(choice : int, player : Player) : String
  + getStagDialogue(player : Player) : List<String>
  + handleStagDialogue(choice : int, player : Player) : String
  + getOrcDialogue(player : Player) : List<String>
  + handleOrcDialogue(choice : int, player : Player) : String
  'Ending
  + getEpilogue(player : Player) : String
}


'Choice'
class Choice {
  'Attributes
  - description : String
  - taken : boolean
  - type : ChoiceType
  - targetLocation : Location
  - enemy : Creature
  - npc : Creature
  - item : Item
  - requirements : List<Requirement>
  'Constructor
  - Choice()
  + {static} moveChoice(description : String, location : Location) : Choice
  + {static} combatChoice(description : String, enemy : Creature) : Choice
  + {static} interactChoice(description : String, npc : Creature) : Choice
  + {static} itemChoice(description : String, item : Item, type : ChoiceType) : Choice
  'Behavior
  + addRequirement(req : Requirement) : void
  + isAvailable(player : Player) : boolean
  + execute(gc : GameController) : void
  'Getters / Setters
  + getDescription() : String
  + getType() : ChoiceType
  + getTargetLocation() : Location
  + getEnemy() : Creature
  + getNpc() : Creature
  + getItem() : Item
  + getRequirements() : List<Requirement
  + isTaken() : boolean
  + setTaken(taken : boolean) : void
}

' Classes for requirements used in choices

'ClassRequirement
class ClassRequirement {
- requiredClass : String
+ ClassRequirement (requiredClass : String)
+ isMet(player : player) : boolean
}

'ItemRequirement
class ItemRequirement {
- itemName : String
+ ItemRequirement (itemName : String)
+ isMet (player : Player) : boolean
}

'NpcDeadRequirement
class NpcDeadRequirement {
- npc : NPC
+ isMet(player : Player) :boolean
}

'RaceRequirement
class RaceRequirement {
    - requiredRace : String
    + RaceRequirement(requiredRace : String)
    + isMet(player : Player) : boolean
}

'MultiRequirement
class MultiRequirement {
    - requirements : List<Requirement>
    - operator : ChoiceType
    + MultiRequirement(requirements : List<Requirement>, operator : ChoiceType)
    + isMet(player : Player) : boolean
}

' Interface for requirements

interface Requirement {
 + isMet(player : Player) : boolean
}

' Choice types for Choice
enum ChoiceType {
    MOVE
    COMBAT
    INTERACT
    USEITEM
    EQUIPARMOUR
    EQUIPWEAPON

    AND
    OR
}


'Stats'
class Stats {
    - health : int
    - strength : int
    - dexterity : int
    - intelligence : int
    + getHealth() : int
    + setHealth(value : int) : void
    + getStrength() : int
    + setStrength(value : int) : void
    + getDexterity() : int
    + setDexterity(value : int) : void
    + getIntelligence() : int
    + setIntelligence(value : int) : void
    + applyModifier(stat : String, modifier : int) : void
}

'Creature'
abstract class Creature {
    # name : String
    # race : Race
    # stats : Stats
    + {abstract} interact() : void
    + fight(target : Creature) : void
    + pickUpItem(item : Item) : void
    + getName() : String
    + getRace() : Race
    + getStats() : Stats
}

'Player'
class Player {
    - characterClass : String
    - inventory : Inventory
    - questLog : List<Quest>
    - equippedWeapon : Weapon
    + interact() : void
    + addQuest(quest : Quest) : void
    + completeQuest(questID : String) : void
    + attack(target : Creature) : int
    + heal(amount : int) : void
    + getCharacterClass() : String
    + getInventory() : Inventory
    + getQuestLog() : List<Quest>
    + getEquippedWeapon() : Weapon
}

' NPC '
class NPC {
    - dialogue : List<String>
    - questToGive : Object
    - itemHeld : Item
    - isHostile : boolean
    - isDead : boolean
    - originalLocation : String
    - despawnsWhenLeaving : boolean
    - ui : TextUI
    + CPU_Attack(player: Player) : void
    + doesDespawnWhenLeaving() : boolean
    + setDespawnWhenLeaving(value: boolean) : void
    + isHostile() : boolean
    + setHostile(hostile: boolean) : void
    + isDead() : boolean
    + setDead(dead: boolean) : void
    + getOriginalLocation() : String
    + setOriginalLocation(location: String) : void
}

' Race '
class Race {
    - raceName : String
    - healthModifier : int
    - strengthModifier : int
    - dexterityModifier : int
    - intelligenceModifier : int
    - specialAbility : String
    + applyRacialBonuses(stats : Stats) : void
    + getRaceName() : String
    + getSpecialAbility() : String
}

' CharacterClass '
class CharacterClass {
    - characterClassName : String
    - healthModifier : int
    - strengthModifier : int
    - dexterityModifier : int
    - intelligenceModifier : int
    - specialSkills : List<String>
    + CharacterClass(characterClassName : String, healthModifier : int, strengthModifier : int, dexterityModifier : int, intelligenceModifier : int, specialSkills : List<String>)
    + createWarrior() : CharacterClass
    + createMage() : CharacterClass
    + createRanger() : CharacterClass
    + getAllCharacterClasses() : List<CharacterClass>
    + applyCharacterClassBonuses(stats : Stats) : void
    + getCharacterClassName() : String
    + getSpecialSkills() : List<String>
}


'Location'
class Location {
    - locationName : String
    - description : String
    - creatures : List<Creature>
    - items : List<Item>
    - availableChoices : List<Choice>
    - connectedLocations : Map<String, Location>
    + enter(player : Player) : void
    + displayDescription() : String
    + getAvailableChoices() : List<Choice>
    + addCreature(creature : Creature) : void
    + removeCreature(creature : Creature) : void
    + addItem(item : Item) : void
    + removeItem(item : Item) : void
}

'helper class to create items'
class ItemRegistry {
    - Map<String, Item>
    + static Item create()
}

'Inventory'
class Inventory {
    - items : List<Item>
    - maxCapacity : int
    - equippedWeapon : Weapon
    - equippedArmor : Armor
    + addItem(item : Item) : boolean
    + removeItem(item : Item) : void
    + displayInventory() : void
    + hasItem(itemName : String) : boolean
    + getItems() : List<Item>
}

' Items '
abstract class Item {
    # itemName : String
    # description : String
    # weight : int
    + Item(itemName, description, weight)
    # Item(Item other)
    + abstract Item copy()
    + {abstract} use(player : Player) : void
    + add(inventory : Inventory) : void
    + remove(inventory : Inventory) : void
    + getItemName() : String
    + getDescription() : String
}

class Objects {
    - isActive : boolean
    - name : String
    + dealDamage() : void

}
class Health {
    - healAmount : int
    + use(player : Player) : void
    + getHealAmount() : int
}

class Key {
    - keyId : String
    - doorId : String
    + use(player : Player) : void
    + unlockDoor(doorId : String) : boolean
}

class Weapon {
    - damage : int
    - damageType : String
    - range : int
    + use(player : Player) : void
    + attack() : int
    + getDamage() : int
}

class Armor {
    - defenseBonus : int
    - armorType : String
    + use(player : Player) : void
    + getDefenseBonus() : int
}

'quests'
class Quest {
    - questId : String
    - questName : String
    - description : String
    - isCompleted : boolean
    - requiredItem : String
    - reward : Item
    + use(player : Player) : void
    + completeQuest(player : Player) : void
    + getQuestId() : String
    + isCompleted() : boolean
}

' Game Controller relationships
GameController "1" --> "1" Player : manages
GameController "1" --> "1" Location : currentLocation
GameController "1" --> "1" TextUI : uses
GameController "1" --> "1" DataSaving : uses
GameController "1" --> "*" Choice : processes

' Location relationships
Location "1" --> "*" Creature : contains
Location "1" --> "*" Item : contains
Location "1" --> "*" Choice : offers
Location "*" --> "*" Location : connectedTo
Location "1" --> "1" Story : references

' Objects relationships
Location "0" --> "*" Objects : has
Key --> Objects : can unlock

' Creature hierarchy
Creature <|-- Player : extends
Creature <|-- NPC : extends

' Creature composition
Creature "1" --> "1" Race : has
Creature "1" --> "1" Stats : has

' Player composition
Player "1" --> "1" CharacterClass : has
Player "1" --> "1" Inventory : has
Player "1" --> "*" Quest : tracks
Player "1" --> "0..1" Weapon : equippedWeapon
Player "1" --> "0..1" Armor : equippedArmor
Player --> Choice : can make

' NPC composition
NPC "1" --> "0..1" Quest : canGive
NPC "1" --> "0..1" Item : holds

' Inventory relationships
Inventory "1" --> "*" Item : contains
Inventory "1" --> "0..1" Weapon : equippedWeapon
Inventory "1" --> "0..1" Armor : equippedArmor

' ItemRegistry relationship
DataSaving --> ItemRegistry : uses
ItemRegistry --> Item : creates

' Item hierarchy
Item <|-- Health : extends
Item <|-- Key : extends
Item <|-- Weapon : extends
Item <|-- Armor : extends
Item <|-- Quest : extends

' Choice relationship
Choice "1" --> "0..1" Location : leadsTo
Choice --> "0..1" Creature : enemy
Choice --> "0..1" Creature : npc
Choice --> "0..1" Item : item
Choice --> GameController : execute()
Choice --> ChoiceType : uses
Choice --> ClassRequirement : uses
Choice --> ItemRequirement : uses
Choice --> NpcDeadRequirement : uses
Choice --> RaceRequirement : uses
Choice --> MultiRequirement : uses
MultiRequirement --> ChoiceType : uses

ClassRequirement --|> Requirement
ItemRequirement --|> Requirement
NpcDeadRequirement --|> Requirement
RaceRequirement --|> Requirement
MultiRequirement --|> Requirement

@enduml